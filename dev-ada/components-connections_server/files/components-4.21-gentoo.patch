--- components.ORIG/settings.gpr.in	1970-01-01 00:00:00.000000000 +0000
+++ components/settings.gpr.in	2017-05-08 22:45:49.076689198 +0000
@@ -0,0 +1,95 @@
+abstract project Settings is
+
+   for Source_Files use ();
+
+   type Library_T is ("static", "static-pic", "relocatable");
+   Library_Type : Library_T := external ("LIBRARY_TYPE", "static");
+   
+   type Object_Tracing_Mode is ("Off", "On");
+   Object_Tracing : Object_Tracing_Mode := external ("Traced_objects", "Off");
+
+   type Tasking_Mode is ("Multiple", "Single");
+   Tasking : Tasking_Mode := external ("Tasking", "Multiple");
+
+   type Atomic_Access_Mode is
+        (  "Pragma-atomic",
+           "GCC-built-ins",
+           "GCC-long-offsets"
+        );
+   Atomic_Access : Atomic_Access_Mode := external ("Atomic_Access", "GCC-long-offsets");
+
+   Lib_Name := "*LIBRARY*NAME*GOES*HERE*";
+   case Object_Tracing is
+      when "Off" =>
+         case Tasking is
+            when "Multiple" =>
+               Lib_Name := "@LIB_NAME@";
+            when "Single" =>
+               Lib_Name := "@LIB_NAME@-Single_Tasking";
+         end case;
+      when "On" =>
+         case Tasking is
+            when "Multiple" =>
+               Lib_Name := "@LIB_NAME@-Tracing";
+            when "Single" =>
+               Lib_Name := "@LIB_NAME@-Single_Tasking-Tracing";
+         end case;
+   end case;
+   
+   for Library_Name use Lib_Name;
+   for Library_Version use "lib" & Lib_Name & "@SO_EXTENSION@";
+   for Library_Kind use Library_Type;
+   
+   case Object_Tracing is
+      when "Off" =>
+         case Tasking is
+            when "Multiple" =>
+               case Atomic_Access is
+                  when "Pragma-atomic" =>
+                     for Source_Dirs use (".", "atomic-access/ada");
+                  when "GCC-built-ins" =>
+                     for Source_Dirs use (".", "atomic-access/gcc");
+                  when "GCC-long-offsets" =>
+                     for Source_Dirs use (".", "atomic-access/gcc-long-offsets");
+               end case;
+            when "Single" =>
+               case Atomic_Access is
+                  when "Pragma-atomic" =>
+                     for Source_Dirs use ("single-task", ".", "atomic-access/ada");
+                  when "GCC-built-ins" =>
+                     for Source_Dirs use ("single-task", ".", "atomic-access/gcc");
+                  when "GCC-long-offsets" =>
+                     for Source_Dirs use ("single-task", ".", "atomic-access/gcc-long-offsets");
+               end case;
+         end case;
+      when "On" =>
+         case Atomic_Access is
+            when "Pragma-atomic" =>
+               for Source_Dirs use ("gnat-debug", ".", "atomic-access/ada");
+            when "GCC-built-ins" =>
+               for Source_Dirs use ("gnat-debug", ".", "atomic-access/gcc");
+            when "GCC-long-offsets" =>
+               for Source_Dirs use ("gnat-debug", ".", "atomic-access/gcc-long-offsets");
+         end case;
+   end case;
+   
+   package Compiler is
+      for Default_Switches ("ada") use
+         ("-gnatwcikmoprvz.c.p.t.w.x", "-gnatp", "-gnatVa", "-gnatf", "-O2", "-gnatn", "-gnat12") &
+            Split (external ("ADAFLAGS", ""), " ") &
+            ("-fno-strict-aliasing");      
+   end Compiler;
+   
+   package Binder is
+      null;
+   end Binder;
+
+   package Builder is
+      null;
+   end Builder;
+
+   package Linker is
+      null;
+   end Linker;
+
+end Settings;
--- components.ORIG/components-connections_server.gpr	2017-05-08 00:10:00.636208352 +0000
+++ components/components-connections_server.gpr	2017-05-08 22:43:38.490456995 +0000
@@ -1,8 +1,15 @@
-with "components.gpr";
+with "components";
+with "settings";
 
 project Components.Connections_Server is
 
-   for Source_Dirs use Components'Source_Dirs;
+   for Source_Dirs use Settings'Source_Dirs;
+   for Library_Name use Settings'Library_Name;
+   for Library_Version use Settings'Library_Version;
+   for Library_Kind use Settings'Library_Kind;
+   for Object_Dir use "obj/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   for Library_Dir use "lib/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+
    for Source_Files use
    (  "gnat-sockets-connection_state_machine.adb",
       "gnat-sockets-connection_state_machine.ads",
@@ -50,10 +57,10 @@
       "gnat-sockets-server-pooled.ads"
    );
 
-   package Compiler renames Components.Compiler;
-   package Binder   renames Components.Binder;
-   package Builder  renames Components.Builder;
-   package Linker   renames Components.Linker;
+   package Compiler renames Settings.Compiler;
+   package Binder   renames Settings.Binder;
+   package Builder  renames Settings.Builder;
+   package Linker   renames Settings.Linker;
 
 end Components.Connections_Server;
 
--- components.ORIG/components-connections_server-http_server.gpr	2017-05-08 00:10:00.636208352 +0000
+++ components/components-connections_server-http_server.gpr	2017-05-08 23:20:29.540729977 +0000
@@ -1,8 +1,16 @@
-with "components.gpr";
-with "components-connections_server.gpr";
+with "components";
+with "components-connections_server";
+with "settings";
 
 project Components.Connections_Server.HTTP_Server is
 
+   for Source_Dirs use Settings'Source_Dirs;
+   for Library_Name use Settings'Library_Name;
+   for Library_Version use Settings'Library_Version;
+   for Library_Kind use Settings'Library_Kind;
+   for Object_Dir use "obj/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   for Library_Dir use "lib/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   
    for Source_Files use
        (  "gnat-sockets-connection_state_machine-http_client.adb",
           "gnat-sockets-connection_state_machine-http_client.ads",
@@ -14,9 +22,9 @@
           "gnat-sockets-connection_state_machine-http_server-websocket_server.ads"
        );
 
-   package Compiler renames Components.Compiler;
-   package Binder   renames Components.Binder;
-   package Builder  renames Components.Builder;
-   package Linker   renames Components.Linker;
+   package Compiler renames Settings.Compiler;
+   package Binder   renames Settings.Binder;
+   package Builder  renames Settings.Builder;
+   package Linker   renames Settings.Linker;
 
-end Components.Connections_Server.HTTP_Server;
\ No newline at end of file
+end Components.Connections_Server.HTTP_Server;
--- components.ORIG/components-gnutls.gpr	2017-05-08 00:10:00.636208352 +0000
+++ components/components-gnutls.gpr	2017-05-09 12:55:02.730053231 +0000
@@ -1,14 +1,34 @@
-with "components.gpr";
+with "components";
+with "gnutls";
+with "settings";
 
 project Components.GNUTLS is
 
+   for Source_Dirs use Settings'Source_Dirs;
+   for Library_Name use Settings'Library_Name;
+   for Library_Version use Settings'Library_Version;
+   for Library_Kind use Settings'Library_Kind;
+   for Object_Dir use "obj/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   for Library_Dir use "lib/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   
    for Source_Files use
        (  "gnutls.adb",
           "gnutls.ads"
        );
 
+   package Compiler renames Settings.Compiler;
+   package Binder   renames Settings.Binder;
+   package Builder  renames Settings.Builder;
+
    package Linker is
-      for Linker_Options use ("-lgnutls");
+      case Settings.Library_Type is
+         when "static" | "static-pic" =>
+            for Linker_Options use ("-lgnutls");
+         when "relocatable" =>
+            -- We link the shared library with GnuTLS, so there is
+            -- is no need to specify GnuTLS again.
+            null;
+      end case;
    end Linker;
 
 end Components.GNUTLS;
--- components.ORIG/components.gpr	2017-05-08 00:10:00.636208352 +0000
+++ components/components.gpr	2017-05-08 22:43:50.222028667 +0000
@@ -1,53 +1,16 @@
-with "strings_edit.gpr";
-with "tables.gpr";
+with "strings_edit";
+with "tables";
+with "settings";
 
 project Components is
 
-   type Object_Tracing_Mode is ("Off", "On");
-   Object_Tracing : Object_Tracing_Mode := external ("Traced_objects", "Off");
-
-   type Tasking_Mode is ("Multiple", "Single");
-   Tasking : Tasking_Mode := external ("Tasking", "Multiple");
-
-   type Atomic_Access_Mode is
-        (  "Pragma-atomic",
-           "GCC-built-ins",
-           "GCC-long-offsets"
-        );
-   Atomic_Access : Atomic_Access_Mode := external ("Atomic_Access", "GCC-long-offsets");
-
-   case Object_Tracing is
-      when "Off" =>
-         case Tasking is
-            when "Multiple" =>
-               case Atomic_Access is
-                  when "Pragma-atomic" =>
-                     for Source_Dirs use (".", "atomic-access/ada");
-                  when "GCC-built-ins" =>
-                     for Source_Dirs use (".", "atomic-access/gcc");
-                  when "GCC-long-offsets" =>
-                     for Source_Dirs use (".", "atomic-access/gcc-long-offsets");
-               end case;
-            when "Single" =>
-               case Atomic_Access is
-                  when "Pragma-atomic" =>
-                     for Source_Dirs use ("single-task", ".", "atomic-access/ada");
-                  when "GCC-built-ins" =>
-                     for Source_Dirs use ("single-task", ".", "atomic-access/gcc");
-                  when "GCC-long-offsets" =>
-                     for Source_Dirs use ("single-task", ".", "atomic-access/gcc-long-offsets");
-               end case;
-         end case;
-      when "On" =>
-         case Atomic_Access is
-            when "Pragma-atomic" =>
-               for Source_Dirs use ("gnat-debug", ".", "atomic-access/ada");
-            when "GCC-built-ins" =>
-               for Source_Dirs use ("gnat-debug", ".", "atomic-access/gcc");
-            when "GCC-long-offsets" =>
-               for Source_Dirs use ("gnat-debug", ".", "atomic-access/gcc-long-offsets");
-         end case;
-   end case;
+   for Source_Dirs use Settings'Source_Dirs;
+   for Library_Name use Settings'Library_Name;
+   for Library_Version use Settings'Library_Version;
+   for Library_Kind use Settings'Library_Kind;
+   for Object_Dir use "obj/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   for Library_Dir use "lib/" & Settings.Library_Type & "." & Settings.Tasking & "." & Settings.Object_Tracing;
+   
    for Source_Files use
    (  "backward_link_handles.ads",
       "backward_link_handles-sets.ads",
@@ -275,9 +238,9 @@
       "tables-utf8_names.ads"
    );
 
-   package Compiler renames Strings_Edit.Compiler;
-   package Binder   renames Strings_Edit.Binder;
-   package Builder  renames Strings_Edit.Builder;
-   package Linker   renames Strings_Edit.Linker;
+   package Compiler renames Settings.Compiler;
+   package Binder   renames Settings.Binder;
+   package Builder  renames Settings.Builder;
+   package Linker   renames Settings.Linker;
 
 end Components;
